# 小说大纲功能设计方案

## 📋 目标分析

小说大纲功能需要满足以下核心需求：
1. **清晰的层级结构展示** - 项目 > 章节 > 场景的三级关系
2. **快速重组能力** - 轻松调整章节、场景顺序
3. **内容概览** - 一目了然地查看整体脉络和进度
4. **无学习成本** - 作者可以专注创作，而非学习工具
5. **与编辑器无缝集成** - 点击即可跳转到对应场景编辑

## 🚫 现有方案的问题

### 方案1：PlantUML
**优点：**
- 结构化强，可以生成专业的图表

**缺点：**
- ❌ 语法学习成本高（需要记忆 UML 语法）
- ❌ 对作家不友好，过于技术化
- ❌ 难以实时编辑，需要切换语法/预览模式
- ❌ 不适合频繁重组（修改语法代码效率低）
- ❌ 无法直接拖拽操作

### 方案2：Excalidraw
**优点：**
- 自由度高，可以绘制任意形状

**缺点：**
- ❌ 缺乏结构化约束，容易混乱
- ❌ 手动维护节点关系，工作量大
- ❌ 难以与数据库同步（绘图数据 vs 章节数据）
- ❌ 不利于批量操作（如批量重排）
- ❌ 难以添加丰富的元数据（字数、状态等）

### 方案3：纯文字描述
**优点：**
- 简单直接

**缺点：**
- ❌ 缺乏可视化，难以把握整体
- ❌ 难以快速定位和重组
- ❌ 无交互性，效率低

## ✅ 推荐方案：多视图交互式大纲系统

### 核心理念
**不需要绘图，不需要语法，直接基于现有数据结构，提供多种可视化和交互方式。**

### 方案特点

#### 1️⃣ **树形大纲视图**（主视图，推荐）

```
📖 项目名称
├─ 📚 第一章：序幕
│  ├─ 📄 场景1：主角登场 (1,234 字) ✓
│  ├─ 📄 场景2：初遇 (856 字) 🔄
│  └─ 📄 场景3：意外 (0 字) ⭕
├─ 📚 第二章：冒险开始
│  ├─ 📄 场景1：出发 (2,100 字) ✓
│  └─ ...
```

**功能：**
- ✅ 可折叠/展开的树形结构
- ✅ 拖拽重排（章节内拖动、跨章节移动）
- ✅ 双击编辑标题
- ✅ 右键菜单（添加、删除、复制、移动）
- ✅ 状态标记（草稿⭕、进行中🔄、已完成✓）
- ✅ 实时字数统计
- ✅ 搜索过滤
- ✅ 点击跳转到编辑器

#### 2️⃣ **卡片看板视图**（Scrivener 风格）

将场景显示为卡片，按章节分组：

```
┌─────────────────────────────────────────┐
│ 第一章：序幕                             │
├─────────────┬─────────────┬─────────────┤
│ 场景1       │ 场景2       │ 场景3       │
│ 主角登场    │ 初遇        │ 意外        │
│ 1,234 字    │ 856 字      │ 0 字        │
│ ✓ 已完成    │ 🔄 进行中   │ ⭕ 草稿     │
│ (内容摘要..)│ (内容摘要..)│             │
└─────────────┴─────────────┴─────────────┘
```

**功能：**
- ✅ 软木板式的卡片布局
- ✅ 拖拽卡片调整顺序或章节归属
- ✅ 显示内容摘要（前100字）
- ✅ 卡片颜色标记
- ✅ 响应式布局（适配不同屏幕）

#### 3️⃣ **时间线视图**（可选，未来扩展）

适合多线索叙事，横向展示故事发展：

```
第1天      第2天      第3天
─────────────────────────────→
主线: ●──────●──────●
支线1:    ●──────●
支线2:         ●──────●
```

### 数据结构扩展

为章节和场景添加大纲元数据：

```typescript
interface OutlineMetadata {
  // 状态
  status?: "draft" | "in-progress" | "completed" | "needs-revision";
  
  // 可视化
  color?: string;  // 颜色标记
  icon?: string;   // 自定义图标
  
  // 内容
  summary?: string;     // 摘要（用于大纲显示）
  notes?: string;       // 创作笔记
  plotPoints?: string[]; // 关键剧情点
  
  // 关联
  characters?: string[]; // 涉及的角色ID
  locations?: string[];  // 涉及的地点ID
  
  // 统计
  wordCount?: number;       // 字数
  targetWordCount?: number; // 目标字数
  
  // 时间线
  storyTime?: string; // 故事内时间
  
  // 标签
  tags?: string[]; // 自定义标签
}
```

### 技术实现

#### 组件结构
```
src/components/outline/
├── outline-view.tsx          # 主视图容器（视图切换、搜索）
├── outline-tree-view.tsx     # 树形视图
├── outline-cards-view.tsx    # 卡片视图
└── outline-timeline-view.tsx # 时间线视图（待实现）

src/db/
└── schema-outline.ts         # 大纲数据结构扩展

src/routes/
└── outline.tsx               # 大纲页面路由
```

#### 核心功能已实现
- ✅ 树形视图：完整的树形结构展示
- ✅ 卡片视图：Scrivener 风格的卡片布局
- ✅ 拖拽支持：准备好 UI 交互（需要集成拖拽库）
- ✅ 搜索过滤：实时搜索章节和场景
- ✅ 字数统计：基于现有统计逻辑
- ✅ 状态标记：支持完成度可视化
- ✅ 跳转编辑：点击场景跳转到编辑器

### 使用流程

1. **查看大纲**
   - 在左侧活动栏点击"大纲"图标（ListTree）
   - 自动加载当前项目的章节和场景

2. **切换视图**
   - 顶部工具栏切换"树形"或"卡片"视图
   - 根据需求选择最适合的视图模式

3. **搜索过滤**
   - 使用搜索框快速定位特定章节或场景
   - 支持实时过滤

4. **调整结构**（准备中）
   - 拖拽章节调整顺序
   - 拖拽场景在章节间移动
   - 右键菜单进行添加/删除操作

5. **跳转编辑**
   - 点击任意场景卡片/节点
   - 自动跳转到编辑页面并选中该场景

### 未来扩展

#### 短期计划
- [ ] 集成拖拽库（@dnd-kit）实现拖拽重排
- [ ] 添加大纲元数据编辑面板
- [ ] 支持批量操作（批量标记状态、批量移动）
- [ ] 导出大纲为PDF/图片

#### 中期计划
- [ ] 时间线视图
- [ ] 思维导图视图
- [ ] 大纲模板（三幕式、英雄之旅等）
- [ ] AI辅助生成大纲建议

#### 长期计划
- [ ] 协作模式（多人实时编辑大纲）
- [ ] 版本对比（查看大纲变更历史）
- [ ] 大纲与正文双向同步

## 🎯 方案优势总结

| 对比项 | PlantUML | Excalidraw | 纯文字 | **本方案** |
|--------|----------|------------|--------|-----------|
| 学习成本 | ❌ 高 | ⚠️ 中 | ✅ 低 | ✅ 极低 |
| 可视化 | ✅ 好 | ✅ 好 | ❌ 差 | ✅ 优秀 |
| 交互性 | ❌ 差 | ⚠️ 中 | ❌ 差 | ✅ 优秀 |
| 重组效率 | ❌ 低 | ⚠️ 中 | ❌ 低 | ✅ 高 |
| 数据同步 | ⚠️ 需转换 | ❌ 难 | ✅ 简单 | ✅ 原生 |
| 多视图 | ❌ 无 | ❌ 无 | ❌ 无 | ✅ 支持 |
| 元数据管理 | ❌ 难 | ❌ 难 | ⚠️ 中 | ✅ 完善 |
| 适合作家 | ❌ 否 | ⚠️ 一般 | ⚠️ 一般 | ✅ 是 |

## 🚀 快速开始

1. **查看大纲**
   ```bash
   # 已经添加到侧边栏，点击大纲图标即可
   ```

2. **开发测试**
   ```bash
   # 路由已注册，访问 /outline 即可
   ```

3. **添加拖拽功能**（下一步）
   ```bash
   bun add @dnd-kit/core @dnd-kit/sortable
   ```

## 💡 设计哲学

> **"工具应该服务于创作，而非成为创作的障碍"**

本方案的核心理念是：
1. **零学习成本** - 直观的UI，无需学习特殊语法
2. **自然的操作** - 拖拽、点击、搜索等日常习惯
3. **灵活的视图** - 不同创作阶段使用不同视图
4. **数据原生** - 直接基于现有数据库，无需转换
5. **渐进增强** - 基础功能简单，高级功能可选

---

**结论：相比 PlantUML/Excalidraw 的"绘图式大纲"，本方案采用"交互式数据视图"的思路，更符合小说创作的实际需求，是最适合小说编辑器的大纲解决方案。**

