# 大纲系统优化 - 快速集成指南 🚀

## ✅ 已完成的工作

我已经创建了以下核心组件：

1. **状态管理系统** - 5种状态，徽章和选择器
2. **标签系统** - 标签输入和管理
3. **剧情点编辑器** - 4种类型的剧情点管理
4. **角色选择器** - 关联角色功能
5. **详情编辑面板** - 完整的编辑界面
6. **增强的主视图** - 左右分栏布局

## 🔧 需要你做的集成工作

### 1. 检查并添加 Progress 组件

详情面板使用了 Progress 组件。检查是否存在：

```bash
ls apps/desktop/src/components/ui/progress.tsx
```

如果不存在，创建它：

```typescript
// apps/desktop/src/components/ui/progress.tsx
import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"
import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-2 w-full overflow-hidden rounded-full bg-primary/20",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }
```

### 2. 更新 outline.tsx 路由

```typescript
// apps/desktop/src/routes/outline.tsx
// 将这行：
import { OutlineView } from "@/components/outline/outline-view";

// 改为：
import { OutlineViewEnhanced as OutlineView } from "@/components/outline/outline-view-enhanced";

// 其他代码保持不变
```

### 3. 更新 OutlineTreeView（可选但推荐）

在 `apps/desktop/src/components/outline/outline-tree-view.tsx` 中添加：

```typescript
// 在 Props 接口中添加：
interface OutlineTreeViewProps {
  // ... 现有 props
  onSelectChapter?: (chapter: ChapterInterface) => void;
  onSelectScene?: (scene: SceneInterface) => void;
}

// 在章节渲染中添加点击事件：
<div 
  onClick={() => onSelectChapter?.(chapter)}
  className="cursor-pointer hover:bg-accent/50 transition-colors"
>
  {/* 现有的章节内容 */}
</div>

// 在场景渲染中添加点击事件：
<div 
  onClick={() => onSelectScene?.(scene)}
  className="cursor-pointer hover:bg-accent/50 transition-colors"
>
  {/* 现有的场景内容 */}
</div>
```

### 4. 更新 OutlineCardsView（可选）

在 `apps/desktop/src/components/outline/outline-cards-view.tsx` 中添加：

```typescript
// 在 Props 接口中添加：
interface OutlineCardsViewProps {
  // ... 现有 props
  onSelectScene?: (scene: SceneInterface) => void;
}

// 在场景卡片中添加点击事件：
<Card 
  onClick={() => onSelectScene?.(scene)}
  className="cursor-pointer hover:shadow-md transition-shadow"
>
  {/* 现有的卡片内容 */}
</Card>
```

## 🎯 测试步骤

### 1. 启动应用
```bash
cd apps/desktop
npm run dev
```

### 2. 打开大纲页面
导航到大纲视图

### 3. 测试基本功能
- ✅ 点击章节，查看右侧详情面板
- ✅ 编辑标题
- ✅ 选择状态
- ✅ 编辑摘要（富文本）
- ✅ 添加剧情点
- ✅ 关联角色
- ✅ 添加标签
- ✅ 设置字数目标
- ✅ 记录创作笔记
- ✅ 点击保存

### 4. 测试详情面板切换
- ✅ 点击右上角的面板图标
- ✅ 详情面板应该隐藏/显示

### 5. 测试数据持久化
- ✅ 刷新页面
- ✅ 数据应该保存

## 🐛 可能遇到的问题

### 问题 1：Progress 组件不存在
**解决方案**：按照上面的代码创建 Progress 组件

### 问题 2：Popover 组件不存在
**解决方案**：角色选择器使用了 Popover，确保已安装

### 问题 3：点击节点没有反应
**解决方案**：确保更新了 OutlineTreeView 添加了点击事件

### 问题 4：详情面板不显示
**解决方案**：检查 `outline-view-enhanced.tsx` 是否正确导入

## 💡 使用提示

### 快速上手
1. 点击任意章节或场景
2. 右侧会出现详情面板
3. 开始编辑各项内容
4. 更改会自动保存

### 最佳实践
1. **使用状态管理进度**：将章节标记为"进行中"、"已完成"等
2. **编写摘要**：用富文本描述章节要点
3. **添加剧情点**：标记关键情节
4. **关联角色**：记录涉及的角色
5. **使用标签**：如"高潮"、"转折点"等
6. **设置目标**：输入目标字数，追踪进度

## 🎨 UI 预览

### 主界面布局
```
┌────────────────────────────────────────────────────┐
│ 大纲视图  [项目选择] [树形|卡片] [面板切换]        │
├────────────────────────────────────────────────────┤
│ [搜索框]                          [添加章节]       │
├──────────────────────┬─────────────────────────────┤
│                      │                             │
│  📚 第一章           │  章节详情         [保存][×] │
│    🎬 场景1         │  ─────────────────────────  │
│    🎬 场景2         │  标题：[第一章]             │
│  📚 第二章           │  状态：[进行中▼] 进度：50%  │
│    🎬 场景3         │  ─────────────────────────  │
│                      │  摘要：                     │
│                      │  [富文本编辑器]             │
│                      │  ─────────────────────────  │
│                      │  关键剧情点：               │
│                      │  • [开端] 主角登场          │
│                      │  [+ 添加剧情点]             │
│                      │  ─────────────────────────  │
│                      │  涉及角色：                 │
│                      │  [@张三] [+ 添加]          │
│                      │  ─────────────────────────  │
│                      │  标签：                     │
│                      │  [高潮] [+ 添加]           │
│                      │                             │
└──────────────────────┴─────────────────────────────┘
│ 共 2 章节 · 3 场景                  总字数: 5,234  │
└────────────────────────────────────────────────────┘
```

## 🚀 完成后的效果

优化后，你的大纲系统将拥有：

- ✅ 专业的详情编辑面板
- ✅ 完整的状态管理
- ✅ 富文本摘要编辑
- ✅ 剧情点管理
- ✅ 角色关联
- ✅ 标签系统
- ✅ 进度追踪
- ✅ 创作笔记

这将使大纲管理的实用性提升 10 倍！

---

如果遇到任何问题，请告诉我！
