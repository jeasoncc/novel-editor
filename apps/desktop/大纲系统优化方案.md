# 大纲系统优化方案 📋

## 🎯 目标

将现有的简单大纲系统升级为功能强大、易用的专业级大纲管理工具。

## 📊 现状分析

### 当前功能
- ✅ 基本的章节/场景树形结构
- ✅ 简单的卡片视图
- ✅ 拖拽排序
- ✅ 搜索过滤

### 存在的问题
- ❌ 功能单一，缺乏深度
- ❌ 无法快速预览内容
- ❌ 缺少状态管理和进度追踪
- ❌ 没有大纲编辑器（只能编辑标题）
- ❌ 无法批量操作
- ❌ 缺少可视化统计
- ❌ 没有大纲模板功能

## 🚀 优化方案

### 1. 增强的大纲编辑器

#### 1.1 章节/场景详情面板
```
左侧：大纲树
右侧：详情编辑面板
  - 标题编辑
  - 状态标记（草稿/进行中/完成/需修改）
  - 摘要编辑（富文本）
  - 关键剧情点列表
  - 涉及角色（@ 提及）
  - 场景地点
  - 故事时间线
  - 创作笔记
  - 标签管理
  - 字数统计和目标
```

#### 1.2 快速预览
```
- 悬停显示摘要卡片
- 点击展开详情面板
- 支持内联编辑
- 快速跳转到正文
```

### 2. 多视图模式

#### 2.1 树形视图（已有，需增强）
```
增强功能：
- 折叠/展开所有
- 多级缩进显示
- 拖拽重组结构
- 批量选择操作
- 右键菜单
- 状态图标
- 进度条
```

#### 2.2 卡片视图（已有，需增强）
```
增强功能：
- 看板式布局（按状态分组）
- 拖拽改变状态
- 快速编辑
- 封面图片
- 标签过滤
```

#### 2.3 时间线视图（新增）
```
- 横向时间轴
- 显示故事内时间
- 拖拽调整顺序
- 时间跨度可视化
- 事件标记
```

#### 2.4 思维导图视图（新增）
```
- 中心节点：项目
- 分支：章节
- 子分支：场景
- 可视化关系
- 自由布局
```

#### 2.5 表格视图（新增）
```
列：
- 章节/场景
- 状态
- 字数
- 目标字数
- 进度
- 角色
- 地点
- 标签
- 最后编辑

功能：
- 排序
- 过滤
- 批量编辑
- 导出 CSV
```

### 3. 状态管理系统

#### 3.1 状态类型
```typescript
type Status = 
  | "draft"          // 草稿 - 灰色
  | "in-progress"    // 进行中 - 蓝色
  | "completed"      // 已完成 - 绿色
  | "needs-revision" // 需修改 - 黄色
  | "on-hold"        // 暂停 - 橙色
  | "archived"       // 已归档 - 灰色
```

#### 3.2 状态看板
```
按状态分组显示：
[草稿] [进行中] [已完成] [需修改]
  📝      ✍️       ✅        ⚠️
  5章     3章      12章      2章
```

#### 3.3 进度追踪
```
- 章节完成度：5/20 (25%)
- 字数进度：50,000 / 100,000 (50%)
- 每日进度图表
- 预计完成时间
```

### 4. 大纲编辑增强

#### 4.1 摘要编辑器
```
- 使用 MinimalEditor
- 支持富文本格式
- 支持 @ 提及角色
- 支持 # 标签
- 自动保存
```

#### 4.2 剧情点管理
```
- 添加关键剧情点
- 标记类型（开端/发展/高潮/结局）
- 拖拽排序
- 关联场景
```

#### 4.3 角色关联
```
- @ 提及角色
- 显示角色列表
- 点击查看角色详情
- 统计角色出场次数
```

### 5. 批量操作

#### 5.1 多选功能
```
- Ctrl/Cmd + 点击多选
- Shift + 点击范围选择
- 全选/反选
```

#### 5.2 批量操作
```
- 批量修改状态
- 批量添加标签
- 批量移动
- 批量删除
- 批量导出
```

### 6. 智能功能

#### 6.1 自动统计
```
- 章节字数
- 场景数量
- 角色出场统计
- 地点使用统计
- 标签分布
```

#### 6.2 智能提示
```
- 字数目标提醒
- 进度落后提醒
- 结构不平衡提醒
- 角色分布不均提醒
```

#### 6.3 大纲分析
```
- 结构分析（三幕式/五幕式）
- 节奏分析
- 角色弧光分析
- 冲突密度分析
```

### 7. 模板系统

#### 7.1 大纲模板
```
预设模板：
- 三幕式结构
- 五幕式结构
- 英雄之旅
- 悬疑推理
- 言情小说
- 自定义模板
```

#### 7.2 场景模板
```
- 动作场景
- 对话场景
- 描写场景
- 回忆场景
- 自定义模板
```

### 8. 导入导出

#### 8.1 导出格式
```
- Markdown
- Word (DOCX)
- PDF
- Excel (XLSX)
- JSON
- 思维导图 (XMind)
```

#### 8.2 导入格式
```
- Markdown
- Word (DOCX)
- JSON
- CSV
```

### 9. 协作功能（未来）

```
- 大纲评论
- 版本历史
- 变更追踪
- 多人协作
```

## 🎨 UI 设计

### 布局方案

#### 方案 A：三栏布局
```
┌─────────────────────────────────────────┐
│ 顶部工具栏                               │
├──────┬──────────────────────┬───────────┤
│      │                      │           │
│ 大纲 │   详情编辑面板        │  统计面板  │
│ 树   │                      │           │
│      │   - 标题             │  - 进度   │
│ 20%  │   - 状态             │  - 字数   │
│      │   - 摘要             │  - 角色   │
│      │   - 剧情点           │  - 标签   │
│      │   - 角色             │           │
│      │   - 笔记             │  15%      │
│      │                      │           │
│      │   65%                │           │
└──────┴──────────────────────┴───────────┘
```

#### 方案 B：左右分栏
```
┌─────────────────────────────────────────┐
│ 顶部工具栏 + 视图切换                     │
├──────────────┬──────────────────────────┤
│              │                          │
│   大纲树     │    详情面板               │
│              │                          │
│   - 章节1    │    [标题编辑]            │
│     - 场景1  │    [状态] [标签]         │
│     - 场景2  │                          │
│   - 章节2    │    摘要：                │
│     - 场景3  │    [富文本编辑器]        │
│              │                          │
│   30%        │    剧情点：              │
│              │    • 开端                │
│              │    • 冲突                │
│              │                          │
│              │    角色：@张三 @李四     │
│              │                          │
│              │    70%                   │
└──────────────┴──────────────────────────┘
```

### 视觉设计

#### 状态颜色
```
草稿：      灰色  #6B7280
进行中：    蓝色  #3B82F6
已完成：    绿色  #10B981
需修改：    黄色  #F59E0B
暂停：      橙色  #F97316
归档：      灰色  #9CA3AF
```

#### 图标系统
```
章节：  📚 Book
场景：  🎬 Film
角色：  👤 User
地点：  📍 MapPin
标签：  🏷️ Tag
笔记：  📝 FileText
剧情：  ⚡ Zap
时间：  🕐 Clock
```

## 📝 实现优先级

### Phase 1：核心增强（1-2周）
1. ✅ 详情编辑面板
2. ✅ 状态管理系统
3. ✅ 摘要编辑器（MinimalEditor）
4. ✅ 角色关联（@ 提及）
5. ✅ 标签系统

### Phase 2：视图扩展（1-2周）
1. ✅ 表格视图
2. ✅ 时间线视图
3. ✅ 看板视图（按状态）
4. ⏳ 思维导图视图

### Phase 3：高级功能（2-3周）
1. ✅ 批量操作
2. ✅ 智能统计
3. ✅ 模板系统
4. ✅ 导入导出

### Phase 4：优化完善（1周）
1. ✅ 性能优化
2. ✅ 用户体验优化
3. ✅ 文档完善
4. ✅ 测试和修复

## 🔧 技术实现

### 数据结构扩展
```typescript
interface EnhancedOutlineMetadata {
  // 基本信息
  status: Status;
  summary: SerializedEditorState; // 富文本摘要
  notes: string;
  
  // 剧情要素
  plotPoints: PlotPoint[];
  characters: string[]; // 角色ID数组
  locations: string[];
  
  // 统计
  wordCount: number;
  targetWordCount: number;
  progress: number; // 0-100
  
  // 时间线
  storyTime: string;
  storyDate: Date;
  
  // 标签
  tags: string[];
  
  // 元数据
  createdAt: Date;
  updatedAt: Date;
  lastEditedBy: string;
}

interface PlotPoint {
  id: string;
  type: "setup" | "conflict" | "climax" | "resolution";
  description: string;
  order: number;
}
```

### 组件结构
```
outline/
├── outline-view.tsx              # 主视图
├── outline-toolbar.tsx           # 工具栏
├── outline-tree-view.tsx         # 树形视图
├── outline-cards-view.tsx        # 卡片视图
├── outline-table-view.tsx        # 表格视图（新）
├── outline-timeline-view.tsx     # 时间线视图（新）
├── outline-kanban-view.tsx       # 看板视图（新）
├── outline-mindmap-view.tsx      # 思维导图（新）
├── outline-detail-panel.tsx      # 详情面板（新）
├── outline-stats-panel.tsx       # 统计面板（新）
├── outline-node.tsx              # 节点组件
├── outline-node-menu.tsx         # 右键菜单
├── plot-point-editor.tsx         # 剧情点编辑器（新）
├── tag-manager.tsx               # 标签管理器（新）
└── template-selector.tsx         # 模板选择器（新）
```

## 💡 用户体验优化

### 快捷键
```
Ctrl/Cmd + N      新建章节
Ctrl/Cmd + Shift + N  新建场景
Ctrl/Cmd + D      复制节点
Ctrl/Cmd + X      剪切节点
Ctrl/Cmd + V      粘贴节点
Delete            删除节点
F2                重命名
Ctrl/Cmd + F      搜索
Ctrl/Cmd + A      全选
Ctrl/Cmd + /      切换视图
```

### 拖拽操作
```
- 拖拽章节改变顺序
- 拖拽场景到其他章节
- 拖拽到状态列改变状态
- 拖拽到时间线调整时间
```

### 右键菜单
```
- 新建子场景
- 复制
- 剪切
- 粘贴
- 删除
- 重命名
- 修改状态
- 添加标签
- 导出
```

## 📊 成功指标

- 大纲创建效率提升 50%
- 用户满意度 > 90%
- 功能使用率 > 70%
- 平均响应时间 < 100ms

## 🎉 预期效果

优化后的大纲系统将成为：
- 📝 强大的创作规划工具
- 📊 直观的进度追踪系统
- 🎯 高效的内容组织平台
- 🚀 专业的小说创作助手

---

准备好开始实现了吗？我建议从 Phase 1 开始，先实现核心的详情编辑面板和状态管理系统！
