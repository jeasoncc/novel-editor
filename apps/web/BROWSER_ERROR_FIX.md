# 浏览器错误修复说明

## 问题描述

浏览器控制台出现以下错误：
1. JavaScript 文件加载失败：`main-app.js` 返回 404
2. 字体文件加载失败：多个 Noto Sans SC 字体文件无法加载

## 问题原因

问题是由于 Next.js 配置中使用了 `output: "export"`，这是静态导出配置。在开发模式下，这个配置会导致：
- 静态资源路径不正确
- JavaScript 文件无法正确加载
- 字体文件路径问题

## 已应用的修复

### 1. 修改 Next.js 配置

已将 `next.config.ts` 中的静态导出配置改为条件性启用：

```typescript
// 只在生产构建时使用静态导出
...(process.env.NODE_ENV === "production" && { output: "export" }),
```

这样：
- **开发模式**：不使用静态导出，资源正常加载
- **生产构建**：使用静态导出，适合部署到静态服务器

### 2. 重启开发服务器

已清除缓存并重启服务器，配置更改已生效。

## 解决步骤

### 步骤 1: 清除浏览器缓存

在浏览器中：
1. 按 `Ctrl+Shift+Delete` (Windows/Linux) 或 `Cmd+Shift+Delete` (Mac)
2. 清除缓存和 Cookie
3. 或者使用无痕模式访问

### 步骤 2: 强制刷新页面

在页面上按：
- `Ctrl+Shift+R` (Windows/Linux)
- `Cmd+Shift+R` (Mac)

### 步骤 3: 等待服务器完全启动

如果服务器刚刚重启，等待几秒钟让 Next.js 完全启动。

### 步骤 4: 检查服务器状态

访问 http://localhost:3000，应该能看到完整的页面。

## 验证修复

修复后，浏览器控制台应该：
- ✅ 没有 JavaScript 文件加载错误
- ✅ 没有字体文件加载错误
- ✅ 页面正常渲染
- ✅ 所有功能正常工作

## 如果问题仍然存在

### 检查服务器日志

查看终端中的 Next.js 启动日志，确认：
- 服务器是否完全启动
- 是否有构建错误
- 端口是否正确（3000）

### 手动重启服务器

如果问题持续，手动重启：

```bash
# 停止当前服务器
pkill -f "next dev"

# 清除缓存
cd apps/web
rm -rf .next

# 重新启动
cd ../..
bun web:dev
```

### 检查端口占用

```bash
# 检查 3000 端口
lsof -i :3000

# 如果被占用，可以更改端口
PORT=3001 bun web:dev
```

## 字体加载问题说明

字体文件加载失败通常不会阻止页面显示，因为：
1. Next.js 会自动使用 fallback 字体
2. 字体是渐进式加载的
3. 即使字体加载失败，页面内容仍然可见

但如果字体对显示很重要，可以：
1. 等待服务器完全启动后再访问
2. 检查网络连接
3. 清除浏览器缓存

## 配置说明

### 开发模式配置

开发时，Next.js 会：
- 使用动态路由
- 提供热重载
- 资源通过开发服务器提供

### 生产模式配置

构建时（`npm run build`），Next.js 会：
- 生成静态 HTML 文件
- 优化资源
- 适合部署到静态服务器

## 相关文件

- `apps/web/next.config.ts` - Next.js 配置
- `apps/web/src/app/layout.tsx` - 字体配置
- `apps/web/fix-startup.sh` - 启动修复脚本

---

**最后更新**: 2025年1月

