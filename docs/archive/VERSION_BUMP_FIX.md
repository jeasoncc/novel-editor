# ç‰ˆæœ¬å·è‡ªåŠ¨é€’å¢ä¿®å¤ âœ…

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šæ¯æ¬¡æäº¤æ—¶ï¼Œç‰ˆæœ¬å·ä¸å†è‡ªåŠ¨é€’å¢ã€‚

## é—®é¢˜åŸå› 

Pre-commit hook ä¸­æœ‰ä¸€ä¸ªæ£€æŸ¥é€»è¾‘ï¼š

```bash
# æ—§çš„é€»è¾‘ï¼ˆæœ‰é—®é¢˜ï¼‰
VERSION_FILES_STAGED=$(git diff --cached --name-only | grep -E "(package\.json|PKGBUILD|tauri\.conf\.json|Cargo\.toml)" | wc -l)

if [ "$VERSION_FILES_STAGED" -gt 0 ]; then
    echo "æ£€æµ‹åˆ°ç‰ˆæœ¬å·æ–‡ä»¶å·²åœ¨æš‚å­˜åŒºï¼Œè·³è¿‡è‡ªåŠ¨é€’å¢"
    exit 0
fi
```

**é—®é¢˜ï¼š**
- å½“ç”¨æˆ·ä¿®æ”¹äº† `package.json` æˆ–å…¶ä»–åŒ…å«ç‰ˆæœ¬å·çš„æ–‡ä»¶æ—¶
- Hook ä¼šè®¤ä¸ºè¿™æ˜¯æ‰‹åŠ¨æ›´æ–°ç‰ˆæœ¬å·
- è‡ªåŠ¨è·³è¿‡ç‰ˆæœ¬é€’å¢
- å¯¼è‡´ç‰ˆæœ¬å·ä¸å˜

**è§¦å‘åœºæ™¯ï¼š**
- ä¿®æ”¹ `package.json` çš„ä¾èµ–
- ä¿®æ”¹ `tauri.conf.json` çš„é…ç½®
- ä¿®æ”¹ `Cargo.toml` çš„ä¾èµ–
- ä»»ä½•æ¶‰åŠè¿™äº›æ–‡ä»¶çš„æäº¤

## ä¿®å¤æ–¹æ¡ˆ

ä¿®æ”¹æ£€æŸ¥é€»è¾‘ï¼Œåªåœ¨**ä»…æœ‰ç‰ˆæœ¬æ–‡ä»¶å˜æ›´**æ—¶è·³è¿‡ï¼š

```bash
# æ–°çš„é€»è¾‘ï¼ˆå·²ä¿®å¤ï¼‰
NON_VERSION_FILES=$(git diff --cached --name-only | grep -v -E "(package\.json|PKGBUILD|tauri\.conf\.json|Cargo\.toml|Cargo\.lock)" | wc -l)

if [ "$NON_VERSION_FILES" -eq 0 ]; then
    # åªæœ‰ç‰ˆæœ¬å·æ–‡ä»¶å˜æ›´ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æ‰‹åŠ¨ä¿®æ”¹
    VERSION_FILES_STAGED=$(git diff --cached --name-only | grep -E "(package\.json|PKGBUILD|tauri\.conf\.json|Cargo\.toml)" | wc -l)
    
    if [ "$VERSION_FILES_STAGED" -gt 0 ]; then
        echo "æ£€æµ‹åˆ°ä»…ç‰ˆæœ¬å·æ–‡ä»¶å˜æ›´ï¼Œè·³è¿‡è‡ªåŠ¨é€’å¢"
        exit 0
    fi
fi
```

**æ”¹è¿›ï¼š**
- å…ˆæ£€æŸ¥æ˜¯å¦æœ‰éç‰ˆæœ¬æ–‡ä»¶çš„å˜æ›´
- å¦‚æœæœ‰å…¶ä»–æ–‡ä»¶å˜æ›´ï¼Œæ­£å¸¸é€’å¢ç‰ˆæœ¬å·
- åªæœ‰åœ¨**ä»…ä¿®æ”¹ç‰ˆæœ¬æ–‡ä»¶**æ—¶æ‰è·³è¿‡
- é¿å…æ— é™å¾ªç¯ï¼ˆhook ä¿®æ”¹ç‰ˆæœ¬æ–‡ä»¶ â†’ å†æ¬¡è§¦å‘ hookï¼‰

## ä¿®å¤å†…å®¹

### 1. æ›´æ–° `.git/hooks/pre-commit`

**å˜æ›´ï¼š**
- ä¿®æ”¹ç‰ˆæœ¬æ–‡ä»¶æ£€æŸ¥é€»è¾‘
- æ·»åŠ  `Cargo.lock` åˆ°ç‰ˆæœ¬æ–‡ä»¶åˆ—è¡¨
- æ”¹è¿›è·³è¿‡æ¡ä»¶åˆ¤æ–­

**æ–‡ä»¶ï¼š** `.git/hooks/pre-commit`

### 2. æ›´æ–°æ–‡æ¡£

**æ–‡ä»¶ï¼š** `docs/git-hooks-guide.md`

**æ–°å¢å†…å®¹ï¼š**
- é—®é¢˜æ’æŸ¥ç« èŠ‚
- ç‰ˆæœ¬å·æ²¡æœ‰æ›´æ–°çš„å¸¸è§åŸå› 
- æµ‹è¯• Hook çš„æ–¹æ³•

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

```bash
# 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
echo "test" > test.txt
git add test.txt

# 2. æäº¤
git commit -m "test: version bump"

# 3. æ£€æŸ¥ç‰ˆæœ¬å·ï¼ˆåº”è¯¥é€’å¢ï¼‰
grep version package.json

# 4. æ’¤é”€æµ‹è¯•
git reset --hard HEAD~1
rm test.txt
```

### æµ‹è¯•ç»“æœ

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ”„ è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·...
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âœ… ç‰ˆæœ¬å·å·²è‡ªåŠ¨æ›´æ–°åˆ°: 0.1.12
  ğŸ“ ç‰ˆæœ¬å·æ–‡ä»¶å·²æ·»åŠ åˆ°æš‚å­˜åŒº
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[main ecbe0e7] test: version bump test
 8 files changed, 8 insertions(+), 7 deletions(-)
```

âœ… **ç‰ˆæœ¬å·æˆåŠŸä» 0.1.11 é€’å¢åˆ° 0.1.12**

## ä½¿ç”¨è¯´æ˜

### æ­£å¸¸ä½¿ç”¨

ç°åœ¨å¯ä»¥æ­£å¸¸æäº¤ï¼Œç‰ˆæœ¬å·ä¼šè‡ªåŠ¨é€’å¢ï¼š

```bash
# ä¿®æ”¹ä»»ä½•æ–‡ä»¶
vim README.md

# æäº¤ï¼ˆç‰ˆæœ¬å·è‡ªåŠ¨é€’å¢ï¼‰
git add .
git commit -m "docs: update README"
```

### è·³è¿‡ç‰ˆæœ¬é€’å¢

å¦‚æœéœ€è¦è·³è¿‡ç‰ˆæœ¬é€’å¢ï¼š

```bash
SKIP_VERSION_BUMP=true git commit -m "your message"
```

### æ‰‹åŠ¨é€’å¢ç‰ˆæœ¬

å¦‚æœéœ€è¦æ‰‹åŠ¨æ§åˆ¶ç‰ˆæœ¬å·ï¼š

```bash
# è¿è¡Œè„šæœ¬
./scripts/bump-version.sh

# æäº¤ï¼ˆä¼šè·³è¿‡è‡ªåŠ¨é€’å¢ï¼Œå› ä¸ºåªæœ‰ç‰ˆæœ¬æ–‡ä»¶å˜æ›´ï¼‰
git add package.json apps/*/package.json
git commit -m "chore: bump version"
```

## å·¥ä½œåŸç†

### ç‰ˆæœ¬é€’å¢æµç¨‹

```
1. ç”¨æˆ·æ‰§è¡Œ git commit
   â†“
2. Pre-commit hook è§¦å‘
   â†“
3. æ£€æŸ¥æ˜¯å¦æœ‰éç‰ˆæœ¬æ–‡ä»¶å˜æ›´
   â”œâ”€ æœ‰ â†’ æ‰§è¡Œç‰ˆæœ¬é€’å¢
   â””â”€ æ—  â†’ è·³è¿‡ï¼ˆé¿å…æ— é™å¾ªç¯ï¼‰
   â†“
4. è¿è¡Œ scripts/bump-version.sh
   â†“
5. æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬æ–‡ä»¶
   - package.json (root)
   - apps/desktop/package.json
   - apps/web/package.json
   - apps/desktop/src-tauri/tauri.conf.json
   - apps/desktop/src-tauri/Cargo.toml
   - aur/PKGBUILD
   - aur/PKGBUILD-binary
   â†“
6. å°†ç‰ˆæœ¬æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº
   â†“
7. ç»§ç»­æäº¤
```

### é¿å…æ— é™å¾ªç¯

**é—®é¢˜ï¼š**
- Hook ä¿®æ”¹ç‰ˆæœ¬æ–‡ä»¶
- ç‰ˆæœ¬æ–‡ä»¶è¢«æ·»åŠ åˆ°æš‚å­˜åŒº
- å¦‚æœå†æ¬¡è§¦å‘ hookï¼Œä¼šæ— é™å¾ªç¯

**è§£å†³ï¼š**
- æ£€æŸ¥æ˜¯å¦åªæœ‰ç‰ˆæœ¬æ–‡ä»¶å˜æ›´
- å¦‚æœæ˜¯ï¼Œè¯´æ˜æ˜¯ hook çš„ç»“æœï¼Œè·³è¿‡
- é¿å…æ— é™é€’å½’

## ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶

1. **`.git/hooks/pre-commit`** - Git hook è„šæœ¬
2. **`scripts/bump-version.sh`** - ç‰ˆæœ¬é€’å¢è„šæœ¬

### æ–‡æ¡£

1. **`docs/git-hooks-guide.md`** - Git hooks ä½¿ç”¨æŒ‡å—
2. **`VERSION_BUMP_OPTIMIZATION.md`** - ç‰ˆæœ¬é€’å¢ä¼˜åŒ–è¯´æ˜
3. **`VERSION_BUMP_FIX.md`** - æœ¬æ–‡æ¡£

### ç‰ˆæœ¬æ–‡ä»¶

1. `package.json` - æ ¹ç›®å½•ç‰ˆæœ¬æº
2. `apps/desktop/package.json` - Desktop åº”ç”¨ç‰ˆæœ¬
3. `apps/web/package.json` - Web åº”ç”¨ç‰ˆæœ¬
4. `apps/desktop/src-tauri/tauri.conf.json` - Tauri é…ç½®ç‰ˆæœ¬
5. `apps/desktop/src-tauri/Cargo.toml` - Rust åŒ…ç‰ˆæœ¬
6. `aur/PKGBUILD` - AUR åŒ…ç‰ˆæœ¬
7. `aur/PKGBUILD-binary` - AUR äºŒè¿›åˆ¶åŒ…ç‰ˆæœ¬

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ç‰ˆæœ¬å·ä¸é€’å¢ï¼Ÿ

A: å¦‚æœä½ åªä¿®æ”¹äº†ç‰ˆæœ¬æ–‡ä»¶æœ¬èº«ï¼ˆå¦‚ package.json çš„ä¾èµ–ï¼‰ï¼Œhook ä¼šæ£€æµ‹åˆ°å¹¶è·³è¿‡é€’å¢ã€‚è¿™æ˜¯ä¸ºäº†é¿å…æ— é™å¾ªç¯ã€‚

### Q: å¦‚ä½•å¼ºåˆ¶é€’å¢ç‰ˆæœ¬å·ï¼Ÿ

A: æ‰‹åŠ¨è¿è¡Œè„šæœ¬ï¼š
```bash
./scripts/bump-version.sh
git add .
git commit -m "chore: bump version"
```

### Q: å¦‚ä½•ç¦ç”¨è‡ªåŠ¨é€’å¢ï¼Ÿ

A: ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š
```bash
SKIP_VERSION_BUMP=true git commit -m "your message"
```

æˆ–è€…ç¦ç”¨ hookï¼š
```bash
mv .git/hooks/pre-commit .git/hooks/pre-commit.disabled
```

### Q: ç‰ˆæœ¬å·æ ¼å¼æ˜¯ä»€ä¹ˆï¼Ÿ

A: ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰ï¼š
- æ ¼å¼ï¼š`major.minor.patch`
- ç¤ºä¾‹ï¼š`0.1.11`
- æ¯æ¬¡æäº¤è‡ªåŠ¨é€’å¢ patch ç‰ˆæœ¬

### Q: å¦‚ä½•ä¿®æ”¹é€’å¢è§„åˆ™ï¼Ÿ

A: ç¼–è¾‘ `scripts/bump-version.sh`ï¼Œä¿®æ”¹ `bump_patch_version` å‡½æ•°ã€‚

## æ€»ç»“

**ä¿®å¤å®Œæˆï¼** âœ…

**å…³é”®æ”¹è¿›ï¼š**
- âœ… ä¿®å¤äº†ç‰ˆæœ¬å·ä¸é€’å¢çš„é—®é¢˜
- âœ… æ”¹è¿›äº†æ£€æŸ¥é€»è¾‘ï¼Œæ›´æ™ºèƒ½
- âœ… é¿å…äº†æ— é™å¾ªç¯
- âœ… æ›´æ–°äº†æ–‡æ¡£å’Œæµ‹è¯•æ–¹æ³•

**ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š**
- æ¯æ¬¡æäº¤è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·
- ä¿®æ”¹ package.json ç­‰æ–‡ä»¶ä¹Ÿä¼šæ­£å¸¸é€’å¢
- åªæœ‰åœ¨ä»…ä¿®æ”¹ç‰ˆæœ¬æ–‡ä»¶æ—¶æ‰è·³è¿‡

---

**ä¿®å¤æ—¥æœŸï¼š** 2024-12-09
**ä¿®å¤äººï¼š** Kiro AI Assistant
