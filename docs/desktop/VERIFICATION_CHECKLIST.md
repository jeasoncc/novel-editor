# 功能验证清单

## 📋 使用此清单验证所有新功能

### ✅ 准备工作

- [ ] 确保应用正常运行（`npm run dev`）
- [ ] 打开浏览器开发者工具（F12）
- [ ] 确保有测试数据（至少1个项目、1个章节、1个场景）

---

## 🧪 功能测试

### 1. 数据备份功能

#### 手动备份
- [ ] 按 `Ctrl/Cmd + K` 打开命令面板
- [ ] 输入"备份"，选择"备份数据"
- [ ] 点击"导出 JSON"按钮
- [ ] 验证文件已下载（`novel-editor-backup-YYYY-MM-DD-HHmmss.json`）
- [ ] 点击"导出 ZIP"按钮
- [ ] 验证文件已下载（`novel-editor-backup-YYYY-MM-DD-HHmmss.zip`）

#### 数据统计
- [ ] 在数据管理页面查看统计卡片
- [ ] 验证显示：项目数、章节数、场景数、总字数
- [ ] 数字应该与实际数据匹配

#### 自动备份
- [ ] 启用"自动备份"开关
- [ ] 验证 localStorage 中有 `auto-backup-enabled: "true"`
- [ ] 验证控制台显示"自动备份已启动"
- [ ] 禁用开关，验证显示"自动备份已禁用"

#### 备份恢复
- [ ] 点击"恢复备份"按钮
- [ ] 选择之前导出的 JSON 文件
- [ ] 确认恢复对话框
- [ ] 验证数据恢复成功
- [ ] 页面自动刷新

#### 本地备份
- [ ] 启用自动备份
- [ ] 等待或手动触发备份（控制台：`autoBackupManager.checkAndBackup()`）
- [ ] 验证"本地备份记录"区域显示备份
- [ ] 点击"恢复"按钮测试恢复功能

---

### 2. 全局搜索功能

#### 打开搜索
- [ ] 按 `Ctrl/Cmd + Shift + F`
- [ ] 验证搜索对话框打开
- [ ] 输入框自动获得焦点

#### 搜索场景
- [ ] 输入场景标题的关键词
- [ ] 验证实时显示搜索结果（300ms 延迟）
- [ ] 验证结果显示：标题、项目名、章节名、摘要
- [ ] 验证关键词被高亮显示

#### 搜索角色
- [ ] 输入角色名称
- [ ] 验证显示角色搜索结果
- [ ] 验证显示角色类型标签

#### 搜索世界观
- [ ] 输入世界观条目名称
- [ ] 验证显示世界观搜索结果
- [ ] 验证显示世界观类型标签

#### 键盘导航
- [ ] 使用 `↓` 键向下导航
- [ ] 验证选中项高亮显示
- [ ] 使用 `↑` 键向上导航
- [ ] 按 `Enter` 键选择结果
- [ ] 验证跳转到对应页面
- [ ] 按 `Esc` 键关闭搜索

#### 空状态
- [ ] 清空搜索框
- [ ] 验证显示"输入关键词开始搜索"提示
- [ ] 输入不存在的关键词
- [ ] 验证显示"未找到匹配结果"

---

### 3. 命令面板增强

#### 新增命令
- [ ] 按 `Ctrl/Cmd + K` 打开命令面板
- [ ] 验证显示"全局搜索"命令（带快捷键提示）
- [ ] 验证显示"备份数据"命令
- [ ] 验证显示"数据统计"命令

#### 命令执行
- [ ] 选择"全局搜索"命令
- [ ] 验证打开全局搜索对话框
- [ ] 选择"备份数据"命令
- [ ] 验证跳转到数据管理页面
- [ ] 选择"数据统计"命令
- [ ] 验证跳转到统计页面

---

### 4. 设置页面

#### 导航
- [ ] 打开设置页面
- [ ] 验证左侧导航显示"数据管理"选项
- [ ] 点击"数据管理"
- [ ] 验证跳转到数据管理页面

#### 页面内容
- [ ] 验证显示"数据统计"卡片
- [ ] 验证显示"手动备份"卡片
- [ ] 验证显示"自动备份"卡片
- [ ] 验证显示"危险操作"卡片

---

### 5. 编辑器历史记录（API 测试）

#### 控制台测试
打开浏览器控制台，执行以下命令：

```javascript
// 1. 导入 Store
const { useEditorHistory } = await import('/src/stores/editor-history.ts');
const store = useEditorHistory.getState();

// 2. 测试保存历史
store.pushHistory('test-scene-1', { content: 'test' }, 100);
console.log('✅ 历史记录已保存');

// 3. 测试查询
const canUndo = store.canUndo('test-scene-1');
console.log('可以撤销:', canUndo); // 应该是 true

// 4. 测试撤销
const entry = store.undo('test-scene-1');
console.log('撤销结果:', entry);

// 5. 测试重做
const canRedo = store.canRedo('test-scene-1');
console.log('可以重做:', canRedo); // 应该是 true

// 6. 测试历史计数
const count = store.getHistoryCount('test-scene-1');
console.log('历史记录数:', count);

// 7. 清除测试数据
store.clearHistory('test-scene-1');
console.log('✅ 测试完成');
```

---

### 6. 数据库性能测试

#### 运行测试工具
打开浏览器控制台，执行：

```javascript
// 运行所有测试
await testFeatures.runAll();

// 查看结果
// ✅ 备份功能: 通过
// ✅ 搜索功能: 通过
// ✅ 数据库索引: 通过
```

#### 验证性能
- [ ] 备份测试通过（<2秒）
- [ ] 搜索测试通过（<100ms）
- [ ] 数据库查询测试通过（<50ms）

---

## 🔍 边界情况测试

### 备份功能
- [ ] 空数据库备份（应该成功）
- [ ] 大项目备份（>50个场景，应该<5秒）
- [ ] 恢复损坏的备份文件（应该显示错误）
- [ ] 恢复空备份文件（应该显示错误）

### 搜索功能
- [ ] 搜索空字符串（应该显示提示）
- [ ] 搜索特殊字符（应该正常工作）
- [ ] 搜索超长关键词（应该正常工作）
- [ ] 空数据库搜索（应该显示"未找到"）

### 历史记录
- [ ] 保存超过50个历史记录（应该自动删除旧记录）
- [ ] 不存在的场景撤销（应该返回 null）
- [ ] 清空历史后撤销（应该返回 null）

---

## 🎯 用户体验检查

### 加载状态
- [ ] 备份导出时显示加载状态
- [ ] 备份恢复时显示加载状态
- [ ] 搜索时显示加载动画
- [ ] 统计加载时显示骨架屏

### 错误处理
- [ ] 备份失败显示错误提示
- [ ] 恢复失败显示错误提示
- [ ] 搜索失败不崩溃
- [ ] 网络错误友好提示

### 成功反馈
- [ ] 备份成功显示 Toast 提示
- [ ] 恢复成功显示 Toast 提示
- [ ] 自动备份启用显示提示
- [ ] 操作完成有视觉反馈

---

## 📱 响应式测试

### 不同屏幕尺寸
- [ ] 桌面端（>1024px）正常显示
- [ ] 平板端（768-1024px）正常显示
- [ ] 移动端（<768px）正常显示

### 对话框
- [ ] 搜索对话框在小屏幕上正常显示
- [ ] 备份管理页面在小屏幕上可滚动
- [ ] 按钮在小屏幕上不重叠

---

## 🔐 安全性检查

### 数据安全
- [ ] 备份文件不包含敏感信息
- [ ] 恢复操作有确认对话框
- [ ] 清空数据有二次确认
- [ ] localStorage 数据加密（可选）

### 权限检查
- [ ] 文件下载需要用户授权
- [ ] 文件上传需要用户选择
- [ ] 危险操作有明显警告

---

## 📊 性能检查

### 内存使用
- [ ] 打开应用后内存正常（<200MB）
- [ ] 执行备份后内存正常
- [ ] 执行搜索后内存正常
- [ ] 长时间使用无内存泄漏

### 响应速度
- [ ] 命令面板打开<100ms
- [ ] 搜索对话框打开<100ms
- [ ] 搜索结果显示<500ms
- [ ] 备份导出<5s（大项目）

---

## ✅ 最终检查

### 代码质量
- [ ] 无 TypeScript 错误
- [ ] 无 ESLint 警告
- [ ] 无控制台错误
- [ ] 无控制台警告（除日志）

### 文档完整性
- [ ] README.md 已更新
- [ ] CHANGELOG 已创建
- [ ] 快速入门指南已创建
- [ ] API 文档已创建

### Git 提交
- [ ] 所有文件已添加
- [ ] 提交信息清晰
- [ ] 分支命名规范
- [ ] 无敏感信息

---

## 📝 测试结果

### 测试日期
- 日期: ___________
- 测试人: ___________
- 环境: ___________

### 通过率
- 备份功能: _____ / _____
- 搜索功能: _____ / _____
- 历史记录: _____ / _____
- 性能测试: _____ / _____
- 总计: _____ / _____

### 发现的问题
1. ___________
2. ___________
3. ___________

### 备注
___________
___________
___________

---

## 🎉 完成

如果所有测试通过，恭喜！新功能已经可以发布了。

**下一步**:
1. 创建 Git 标签（v0.1.1）
2. 推送到远程仓库
3. 创建 Release Notes
4. 通知用户更新

