# 内联编辑器设计

## 🎯 设计理念

**不使用弹窗**，而是在图表视图中直接展开编辑器，与应用整体风格保持一致。

## ✅ 核心改进

### 1. 内联显示
- 不使用 Dialog 弹窗
- 直接在主内容区展开
- 与应用其他编辑器风格一致

### 2. 简洁的工具栏
- 类型切换（Mermaid/PlantUML）
- 模板选择
- 视图模式（代码/分屏/预览）
- 保存和关闭按钮

### 3. 统一的配色
- 使用应用的主题色
- `bg-card` - 卡片背景
- `bg-muted/50` - 工具栏背景
- `border` - 边框颜色
- 完全适配深色/浅色模式

### 4. 清晰的布局
```
┌─────────────────────────────────────────────┐
│ 📝 图表编辑器  [类型] [模板] [视图] [保存][×]│
├──────────────────────┬──────────────────────┤
│                      │                      │
│   代码编辑器          │      预览区域         │
│                      │                      │
│                      │                      │
├──────────────────────┴──────────────────────┤
│ Mermaid              4 行 · 50 字符         │
└─────────────────────────────────────────────┘
```

## 🎨 视觉设计

### 配色方案
```tsx
// 主容器
className="bg-card border rounded-lg"

// 工具栏
className="bg-muted/50 border-b"

// 按钮
variant="default"  // 选中状态
variant="ghost"    // 未选中状态

// 状态栏
className="bg-muted/30 border-t text-muted-foreground"
```

### 间距系统
- 工具栏：`px-4 py-2`
- 编辑区：`p-4`
- 按钮：`h-7` (28px)
- 图标：`h-3.5 w-3.5` (14px)

## 📐 布局结构

### 视图模式切换
```
[代码模式]     [分屏模式]     [预览模式]
┌─────────┐   ┌────┬────┐   ┌─────────┐
│         │   │    │    │   │         │
│  代码   │   │代码│预览│   │  预览   │
│         │   │    │    │   │         │
└─────────┘   └────┴────┘   └─────────┘
```

### 编辑器状态
- **查看模式** - 显示图表
- **编辑模式** - 显示编辑器

## 🔄 交互流程

### 创建图表
1. 点击侧边栏"+ 新建"
2. 主内容区切换到编辑器
3. 编辑代码
4. 点击"保存"
5. 自动切回查看模式

### 编辑图表
1. 点击图表的"编辑"按钮
2. 主内容区切换到编辑器
3. 修改代码
4. 点击"保存"
5. 自动切回查看模式

### 取消编辑
- 点击"×"按钮
- 按 Esc 键
- 切换到其他图表

## 💡 优势对比

### 弹窗方案 ❌
- 遮挡主界面
- 需要背景虚化
- 风格不一致
- 操作不流畅

### 内联方案 ✅
- 不遮挡界面
- 无需背景处理
- 风格统一
- 操作流畅

## 🎯 用户体验

### 1. 无缝切换
- 查看 ↔ 编辑 平滑过渡
- 无弹窗打断
- 保持上下文

### 2. 空间利用
- 充分利用主内容区
- 不浪费屏幕空间
- 视野更开阔

### 3. 风格统一
- 与应用整体一致
- 配色和谐
- 组件复用

### 4. 操作便捷
- 快捷键支持
- 一键保存
- 快速关闭

## 🔧 技术实现

### 状态管理
```typescript
const [editorMode, setEditorMode] = useState<"view" | "edit">("view");
const [editingDiagram, setEditingDiagram] = useState<CustomDiagram | null>(null);
```

### 模式切换
```typescript
// 打开编辑器
const handleOpenEditor = (diagram?: CustomDiagram) => {
  setEditingDiagram(diagram || null);
  setEditorMode("edit");
};

// 关闭编辑器
const handleCloseEditor = () => {
  setEditorMode("view");
  setEditingDiagram(null);
};
```

### 条件渲染
```tsx
{editorMode === "edit" ? (
  <DiagramEditorInline
    initialCode={editingDiagram?.code}
    onSave={handleSave}
    onClose={handleClose}
  />
) : (
  renderDiagram()
)}
```

## 📱 响应式设计

### 分屏模式
- 代码区：50%
- 预览区：50%

### 单视图模式
- 代码模式：100% 代码
- 预览模式：100% 预览

## ⌨️ 键盘快捷键

- `Ctrl/Cmd + S` - 保存
- `Esc` - 关闭编辑器

## 🎊 总结

新的内联编辑器设计：

- ✅ **无弹窗** - 直接在主内容区展开
- ✅ **风格统一** - 与应用整体一致
- ✅ **操作流畅** - 无缝切换，不打断
- ✅ **空间高效** - 充分利用屏幕
- ✅ **体验优秀** - 简洁、直观、高效

这才是真正符合你应用风格的编辑器设计！
