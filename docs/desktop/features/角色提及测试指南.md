# 角色 @ 提及功能测试指南

## 已修复的问题

### 1. 编辑器内容不切换
- ✅ 添加了 `key={editorKey}` 强制重新渲染
- ✅ 切换角色时编辑器会正确加载新内容

### 2. @ 提及不工作
- ✅ 删除了冲突的旧文件 `mention-node.ts`
- ✅ 简化了正则表达式，支持中文
- ✅ 在 MinimalEditor 中添加了 MentionsPlugin
- ✅ 在 NovelEditor 中添加了 MentionsPlugin
- ✅ 添加了详细的控制台调试日志

## 测试步骤

### 测试角色管理页面

1. 打开角色管理页面
2. 创建至少2个角色（例如："张三"、"李四"）
3. 点击左侧角色列表切换角色
4. 确认右侧编辑器内容正确切换
5. 在编辑器中输入 `@`
6. 应该看到角色列表弹出

### 测试小说写作页面

1. 打开小说写作页面
2. 在编辑器中输入 `@`
3. 应该看到角色列表弹出
4. 输入角色名的一部分（如 `@张`）
5. 列表应该过滤显示匹配的角色
6. 点击或按回车选择角色
7. 角色名应该插入到文本中

## 调试信息

打开浏览器控制台（F12），你会看到以下调试信息：

- `[@提及] 当前项目角色: X` - 显示加载的角色数量
- `[@提及] 匹配成功:` - 当输入 @ 时显示匹配结果
- `[@提及] 查询字符串:` - 显示当前搜索的内容
- `[@提及] 过滤后的选项:` - 显示过滤后的角色列表
- `[@提及] menuRenderFn 调用` - 显示菜单渲染状态

## 如果还是不工作

### 检查清单

1. **确认有角色数据**
   - 控制台应该显示 `[@提及] 当前项目角色: X`（X > 0）
   - 如果是 0，说明没有角色数据

2. **确认正则匹配**
   - 输入 `@` 后，控制台应该显示 `[@提及] 匹配成功`
   - 如果没有，说明正则表达式有问题

3. **确认菜单渲染**
   - 控制台应该显示 `[@提及] menuRenderFn 调用, anchor: true, options: X`
   - 如果 anchor 是 false，说明锚点元素有问题
   - 如果 options 是 0，说明没有匹配的角色

4. **检查 z-index**
   - 菜单的 z-index 已设置为 9999
   - 如果菜单被遮挡，可能需要调整

## 常见问题

### Q: 输入 @ 没有任何反应
A: 检查控制台是否有 `[@提及] 匹配成功` 日志。如果没有，可能是正则表达式问题。

### Q: 菜单显示但是空的
A: 检查控制台的 `[@提及] 当前项目角色` 数量。如果是 0，需要先创建角色。

### Q: 菜单一闪而过
A: 可能是事件冲突，检查是否有其他插件干扰。

### Q: 选择角色后没有插入
A: 检查控制台的 `[@提及] 选择角色` 日志，确认选择事件触发。

## 下一步优化

如果基本功能正常，可以：
1. 移除调试日志
2. 优化正则表达式以支持更多场景
3. 添加键盘导航优化
4. 添加角色头像显示
