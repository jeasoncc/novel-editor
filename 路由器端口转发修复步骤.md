# 路由器端口转发修复步骤

## 🔍 问题诊断结果

✅ **服务器端完全正常**：
- Nginx 正在监听 1420 端口
- 本地访问正常
- 内网访问正常
- 防火墙未启用

❌ **问题出在路由器端口转发配置**

## 🎯 立即执行的修复步骤

### 步骤 1: 检查并重新配置端口转发

根据你的路由器界面，请按以下步骤操作：

1. **登录路由器管理界面**
   - 访问：`http://61.144.183.96`（你已经能访问）

2. **进入端口转发页面**
   - 点击左侧菜单的"端口转发"

3. **删除现有规则（如果有问题）**
   - 找到 `novel-editor的website` 规则
   - 点击右侧的垃圾桶图标删除

4. **创建新规则**
   - 点击"■ 新建条目"（底部）
   - 填写以下信息：
     ```
     名称: novel-editor-1420
     常用服务器: (留空)
     协议: TCP
     内网IP地址: 192.168.5.4
     外网端口: 1420
     内网端口: 1420
     ```
   - **状态选择：开启** ⚠️ 重要！

5. **点击"提交"按钮** ⚠️ 关键步骤！

6. **等待 1-2 分钟**让配置生效

### 步骤 2: 检查路由器的安全设置

1. **检查"安全配置"页面**
   - 查看是否有防火墙规则阻止了端口转发
   - 确保端口转发功能未被禁用

2. **检查"过滤规则"页面**
   - 查看是否有规则阻止了 1420 端口

### 步骤 3: 尝试重启路由器

如果配置已正确提交但仍然不行：
1. 保存所有配置
2. 重启路由器（物理重启或通过管理界面重启）
3. 等待路由器完全启动（3-5分钟）
4. 再次测试

### 步骤 4: 验证配置是否生效

在外网设备（使用移动网络，不要用 WiFi）上测试：

```bash
# 使用命令行
curl -v http://61.144.183.96:1420

# 或使用浏览器访问
http://61.144.183.96:1420
```

## 🚨 常见问题排查

### 问题 1: 配置提交后没有生效

**可能原因：**
- 没有点击"提交"按钮
- 路由器需要重启
- 配置有冲突

**解决方法：**
1. 删除旧规则
2. 重新创建并确保点击"提交"
3. 重启路由器

### 问题 2: 状态显示"开启"但仍然不行

**检查点：**
1. 内网 IP 地址是否正确：`192.168.5.4`
2. 端口号是否完全一致：`1420 → 1420`
3. 协议是否选择 TCP
4. 是否有其他规则冲突

### 问题 3: 路由器重启后配置丢失

**解决方法：**
1. 确保路由器有足够的存储空间
2. 配置完成后，检查是否有"保存配置"选项
3. 有些路由器需要手动保存配置文件

## 📋 路由器配置检查清单

在路由器界面中，请确认：

- [ ] 端口转发规则状态为"开启"
- [ ] 协议选择为"TCP"
- [ ] 内网 IP 地址：`192.168.5.4`
- [ ] 外网端口：`1420`
- [ ] 内网端口：`1420`
- [ ] 已点击"提交"按钮
- [ ] 有"保存成功"或类似的提示
- [ ] 没有其他规则使用 1420 端口
- [ ] 路由器防火墙没有阻止连接

## 🔧 备用方案：使用其他端口测试

如果 1420 端口一直不行，可以尝试使用 8080 端口来验证端口转发功能：

### 1. 修改 Nginx 配置添加 8080 端口

```bash
sudo nano /etc/nginx/nginx.conf
```

在文件末尾、`}` 之前添加：

```nginx
server {
    listen 8080;
    listen [::]:8080;
    server_name _;
    
    location / {
        root   /home/lotus/test-site;
        index  index.html index.htm;
    }
}
```

### 2. 测试配置并重启

```bash
sudo nginx -t
sudo systemctl reload nginx
```

### 3. 在路由器中添加新的端口转发

```
名称: novel-editor-8080
协议: TCP
内网IP: 192.168.5.4
外网端口: 8080
内网端口: 8080
状态: 开启
```

### 4. 测试

访问：`http://61.144.183.96:8080`

## 💡 重要提示

1. **从外网测试时，必须使用移动网络**，不要使用同一个 WiFi 网络
2. **端口转发配置可能需要几分钟才能生效**
3. **确保服务器的 IP 地址是静态的**，不是动态获取的（DHCP）
4. **如果可能，将服务器设置为静态 IP**，避免 IP 变化导致配置失效

## 🎯 最可能的解决方案

基于你的情况，**最可能的问题是端口转发配置没有正确生效**。

**请尝试：**
1. 删除现有的端口转发规则
2. 重新创建规则，确保所有字段正确
3. **确保点击"提交"按钮**（这是关键！）
4. 等待 2-3 分钟
5. 从外网（使用移动网络）测试访问

## 📞 如果还是不行

请提供以下信息：
1. 路由器型号和固件版本
2. 端口转发配置页面的完整截图（包括提交按钮）
3. 从外网测试的结果（使用移动网络访问）
4. 路由器的"安全配置"页面内容

我可以根据这些信息进一步帮你排查！




